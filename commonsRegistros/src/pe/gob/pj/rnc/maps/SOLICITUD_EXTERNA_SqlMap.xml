<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="SOLICITUD_EXTERNA">
  <resultMap class="pe.gob.pj.rnc.model.SolicitudExterna" id="abatorgenerated_SolicitudExternaResult">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Fri Jul 20 09:24:31 COT 2007.
    -->
    <result column="CODG_CERTI_EXTERNO" jdbcType="INTEGER" property="CODG_CERTI_EXTERNO"/>
    <result column="CODG_ESTADO" jdbcType="CHAR" property="CODG_ESTADO"/>
    <result column="CODG_USUAR" jdbcType="VARCHAR" property="CODG_USUAR"/>
    <result column="CODG_ENTIDAD_EXTERNA" jdbcType="INTEGER" property="CODG_ENTIDAD_EXTERNA"/>
    <result column="codigo_del_motivo" jdbcType="CHAR" property="codigo_del_motivo"/>
    <result column="V_OFI_RESPUESTA_A" jdbcType="VARCHAR" property="v_OFI_RESPUESTA_A"/>
    <result column="V_OFI_RESPUESTA_B" jdbcType="VARCHAR" property="v_OFI_RESPUESTA_B"/>
    <result column="FECH_REGISTRO" jdbcType="TIMESTAMP" property="FECH_REGISTRO"/>
    <result column="FECH_ENVIO" jdbcType="TIMESTAMP" property="FECH_ENVIO"/>
    <result column="FECH_ATENCION" jdbcType="TIMESTAMP" property="FECH_ATENCION"/>
    <result column="NUM_VISTAS_OFI_RESPUESTA_A" jdbcType="INTEGER" property="NUM_VISTAS_OFI_RESPUESTA_A"/>
    <result column="NUM_VISTAS_OFI_RESPUESTA_B" jdbcType="INTEGER" property="NUM_VISTAS_OFI_RESPUESTA_B"/>
    <result column="DESC_REFERENCIA" jdbcType="VARCHAR" property="DESC_REFERENCIA"/>
    <result column="NUM_REGISTROS_ATENDIDOS" jdbcType="INTEGER" property="NUM_REGISTROS_ATENDIDOS"/>
    <result column="NUM_REGISTROS_POR_ATENDER" jdbcType="INTEGER" property="NUM_REGISTROS_POR_ATENDER"/>
    <result column="NUM_ANHO" jdbcType="CHAR" property="NUM_ANHO"/>
    <result column="NUM_CORRELATIVO_OFI" jdbcType="INTEGER" property="NUM_CORRELATIVO_OFI"/>
  </resultMap>
  <sql id="abatorgenerated_Example_Where_Clause">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Fri Jul 20 09:24:31 COT 2007.
    -->
    <iterate conjunction="or" prepend="where" property="oredCriteria" removeFirstPrepend="iterate">
      (
      <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithoutValue">
        $oredCriteria[].criteriaWithoutValue[]$
      </iterate>
      <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithSingleValue">
        $oredCriteria[].criteriaWithSingleValue[].condition$
          #oredCriteria[].criteriaWithSingleValue[].value#
      </iterate>
      <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithListValue">
        $oredCriteria[].criteriaWithListValue[].condition$
        <iterate close=")" conjunction="," open="(" property="oredCriteria[].criteriaWithListValue[].values">
          #oredCriteria[].criteriaWithListValue[].values[]#
        </iterate>
      </iterate>
      <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithBetweenValue">
        $oredCriteria[].criteriaWithBetweenValue[].condition$
        #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
        #oredCriteria[].criteriaWithBetweenValue[].values[1]#
      </iterate>
      )
    </iterate>
  </sql>
  <select id="abatorgenerated_selectByPrimaryKey" parameterClass="pe.gob.pj.rnc.model.SolicitudExterna" resultMap="abatorgenerated_SolicitudExternaResult">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Fri Jul 20 09:24:31 COT 2007.
    -->
    select CODG_CERTI_EXTERNO, CODG_ESTADO, CODG_USUAR, CODG_ENTIDAD_EXTERNA, codigo_del_motivo,
      V_OFI_RESPUESTA_A, V_OFI_RESPUESTA_B, FECH_REGISTRO, FECH_ENVIO, FECH_ATENCION,
      NUM_VISTAS_OFI_RESPUESTA_A, NUM_VISTAS_OFI_RESPUESTA_B, DESC_REFERENCIA,
      NUM_REGISTROS_ATENDIDOS, NUM_REGISTROS_POR_ATENDER, NUM_ANHO, NUM_CORRELATIVO_OFI
    from SOLICITUD_EXTERNA
    where CODG_CERTI_EXTERNO = #CODG_CERTI_EXTERNO:INTEGER#
  </select>
  <select id="abatorgenerated_selectByExample" parameterClass="pe.gob.pj.rnc.model.SolicitudExternaExample" resultMap="abatorgenerated_SolicitudExternaResult">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Fri Jul 20 09:24:31 COT 2007.
    -->
    select CODG_CERTI_EXTERNO, CODG_ESTADO, CODG_USUAR, CODG_ENTIDAD_EXTERNA, codigo_del_motivo,
      V_OFI_RESPUESTA_A, V_OFI_RESPUESTA_B, FECH_REGISTRO, FECH_ENVIO, FECH_ATENCION,
      NUM_VISTAS_OFI_RESPUESTA_A, NUM_VISTAS_OFI_RESPUESTA_B, DESC_REFERENCIA,
      NUM_REGISTROS_ATENDIDOS, NUM_REGISTROS_POR_ATENDER, NUM_ANHO, NUM_CORRELATIVO_OFI
    from SOLICITUD_EXTERNA
    <isParameterPresent>
      <include refid="SOLICITUD_EXTERNA.abatorgenerated_Example_Where_Clause"/>
      <isNotNull property="orderByClause">
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <delete id="abatorgenerated_deleteByPrimaryKey" parameterClass="pe.gob.pj.rnc.model.SolicitudExterna">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Fri Jul 20 09:24:31 COT 2007.
    -->
    delete from SOLICITUD_EXTERNA
    where CODG_CERTI_EXTERNO = #CODG_CERTI_EXTERNO:INTEGER#
  </delete>
  <delete id="abatorgenerated_deleteByExample" parameterClass="pe.gob.pj.rnc.model.SolicitudExternaExample">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Fri Jul 20 09:24:31 COT 2007.
    -->
    delete from SOLICITUD_EXTERNA
    <include refid="SOLICITUD_EXTERNA.abatorgenerated_Example_Where_Clause"/>
  </delete>
  <insert id="abatorgenerated_insert" parameterClass="pe.gob.pj.rnc.model.SolicitudExterna">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Fri Jul 20 09:24:31 COT 2007.
    -->
    <selectKey keyProperty="CODG_CERTI_EXTERNO" resultClass="java.lang.Integer">
      select ISNULL (MAX(CODG_CERTI_EXTERNO),0)+1 FROM SOLICITUD_EXTERNA
    </selectKey>
    insert into SOLICITUD_EXTERNA (CODG_CERTI_EXTERNO, CODG_ESTADO, CODG_USUAR,
      CODG_ENTIDAD_EXTERNA, codigo_del_motivo, V_OFI_RESPUESTA_A, V_OFI_RESPUESTA_B, FECH_REGISTRO,
      FECH_ENVIO, FECH_ATENCION, NUM_VISTAS_OFI_RESPUESTA_A, NUM_VISTAS_OFI_RESPUESTA_B,
      DESC_REFERENCIA, NUM_REGISTROS_ATENDIDOS, NUM_REGISTROS_POR_ATENDER, NUM_ANHO,
      NUM_CORRELATIVO_OFI, CODG_SUPERVISOR, CODG_FIRMA_RNC)
    values (#CODG_CERTI_EXTERNO:INTEGER#, #CODG_ESTADO:CHAR#, #CODG_USUAR:VARCHAR#,
      #CODG_ENTIDAD_EXTERNA:INTEGER#, #codigo_del_motivo:CHAR#, #v_OFI_RESPUESTA_A:VARCHAR#,
      #v_OFI_RESPUESTA_B:VARCHAR#, #FECH_REGISTRO:TIMESTAMP#, #FECH_ENVIO:TIMESTAMP#,
      #FECH_ATENCION:TIMESTAMP#, #NUM_VISTAS_OFI_RESPUESTA_A:INTEGER#,
      #NUM_VISTAS_OFI_RESPUESTA_B:INTEGER#, #DESC_REFERENCIA:VARCHAR#,
      #NUM_REGISTROS_ATENDIDOS:INTEGER#, #NUM_REGISTROS_POR_ATENDER:INTEGER#, #NUM_ANHO:CHAR#,
      #NUM_CORRELATIVO_OFI:INTEGER#, #codgSupervisor:VARCHAR#, #codgFirmaRnc:VARCHAR#)
  </insert>
  <update id="abatorgenerated_updateByPrimaryKey" parameterClass="pe.gob.pj.rnc.model.SolicitudExterna">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Fri Jul 20 09:24:31 COT 2007.
    -->
    update SOLICITUD_EXTERNA
    set CODG_ESTADO = #CODG_ESTADO:CHAR#,
      CODG_USUAR = #CODG_USUAR:VARCHAR#,
      CODG_ENTIDAD_EXTERNA = #CODG_ENTIDAD_EXTERNA:INTEGER#,
      codigo_del_motivo = #codigo_del_motivo:CHAR#,
      V_OFI_RESPUESTA_A = #v_OFI_RESPUESTA_A:VARCHAR#,
      V_OFI_RESPUESTA_B = #v_OFI_RESPUESTA_B:VARCHAR#,
      FECH_REGISTRO = #FECH_REGISTRO:TIMESTAMP#,
      FECH_ENVIO = #FECH_ENVIO:TIMESTAMP#,
      FECH_ATENCION = #FECH_ATENCION:TIMESTAMP#,
      NUM_VISTAS_OFI_RESPUESTA_A = #NUM_VISTAS_OFI_RESPUESTA_A:INTEGER#,
      NUM_VISTAS_OFI_RESPUESTA_B = #NUM_VISTAS_OFI_RESPUESTA_B:INTEGER#,
      DESC_REFERENCIA = #DESC_REFERENCIA:VARCHAR#,
      NUM_REGISTROS_ATENDIDOS = #NUM_REGISTROS_ATENDIDOS:INTEGER#,
      NUM_REGISTROS_POR_ATENDER = #NUM_REGISTROS_POR_ATENDER:INTEGER#,
      NUM_ANHO = #NUM_ANHO:CHAR#,
      NUM_CORRELATIVO_OFI = #NUM_CORRELATIVO_OFI:INTEGER#
    where CODG_CERTI_EXTERNO = #CODG_CERTI_EXTERNO:INTEGER#
  </update>
  <update id="abatorgenerated_updateByPrimaryKeySelective" parameterClass="pe.gob.pj.rnc.model.SolicitudExterna">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Fri Jul 20 09:24:31 COT 2007.
    -->
    update SOLICITUD_EXTERNA
    <dynamic prepend="set">
      <isNotNull prepend="," property="CODG_ESTADO">
        CODG_ESTADO = #CODG_ESTADO:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="CODG_USUAR">
        CODG_USUAR = #CODG_USUAR:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="CODG_ENTIDAD_EXTERNA">
        CODG_ENTIDAD_EXTERNA = #CODG_ENTIDAD_EXTERNA:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="codigo_del_motivo">
        codigo_del_motivo = #codigo_del_motivo:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="v_OFI_RESPUESTA_A">
        V_OFI_RESPUESTA_A = #v_OFI_RESPUESTA_A:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="v_OFI_RESPUESTA_B">
        V_OFI_RESPUESTA_B = #v_OFI_RESPUESTA_B:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="FECH_REGISTRO">
        FECH_REGISTRO = #FECH_REGISTRO:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="FECH_ENVIO">
        FECH_ENVIO = #FECH_ENVIO:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="FECH_ATENCION">
        FECH_ATENCION = #FECH_ATENCION:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="NUM_VISTAS_OFI_RESPUESTA_A">
        NUM_VISTAS_OFI_RESPUESTA_A = #NUM_VISTAS_OFI_RESPUESTA_A:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="NUM_VISTAS_OFI_RESPUESTA_B">
        NUM_VISTAS_OFI_RESPUESTA_B = #NUM_VISTAS_OFI_RESPUESTA_B:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="DESC_REFERENCIA">
        DESC_REFERENCIA = #DESC_REFERENCIA:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="NUM_REGISTROS_ATENDIDOS">
        NUM_REGISTROS_ATENDIDOS = #NUM_REGISTROS_ATENDIDOS:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="NUM_REGISTROS_POR_ATENDER">
        NUM_REGISTROS_POR_ATENDER = #NUM_REGISTROS_POR_ATENDER:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="NUM_ANHO">
        NUM_ANHO = #NUM_ANHO:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="NUM_CORRELATIVO_OFI">
        NUM_CORRELATIVO_OFI = #NUM_CORRELATIVO_OFI:INTEGER#
      </isNotNull>
    </dynamic>
    where CODG_CERTI_EXTERNO = #CODG_CERTI_EXTERNO#
  </update>
  <!-- INICO -->
  <select id="seleccionarSolicitudes" parameterClass="pe.gob.pj.rnc.criterio.CriterioListarSolicitudExterna" resultClass="pe.gob.pj.rnc.model.SolicitudExterna">
	 SELECT distinct SE.CODG_CERTI_EXTERNO, SE.CODG_ESTADO, codigo_del_motivo,
	 SE.CODG_USUAR, SE.CODG_ENTIDAD_EXTERNA, SE.V_OFI_RESPUESTA_A, SE.V_OFI_RESPUESTA_B,  SE.FECH_REGISTRO, SE.FECH_ENVIO,
	 SE.FECH_ATENCION, SE.NUM_VISTAS_OFI_RESPUESTA_A, SE.NUM_VISTAS_OFI_RESPUESTA_B,  SE.DESC_REFERENCIA, SE.NUM_REGISTROS_ATENDIDOS,
	 SE.NUM_REGISTROS_POR_ATENDER, ESC.DESC_ESTADO
	  from SOLICITUD_EXTERNA SE
	  INNER JOIN SOLICITUD_EXTERNA_ITEM SEI ON SE.CODG_CERTI_EXTERNO = SEI.CODG_CERTI_EXTERNO
	  INNER JOIN SOLICITUDES_PROVINCIA SP ON SEI.CODG_CERTI = SP.CODG_CERTI
	  INNER JOIN ESTADO_SOLICITUD_CERTIFICADO ESC ON ESC.CODG_ESTADO = SE.CODG_ESTADO
	<dynamic prepend="WHERE">
      <isNotNull prepend="AND" property="codigoUsuario">
        SE.CODG_USUAR LIKE #codigoUsuario:VARCHAR#
      </isNotNull>
      <isNull prepend="AND" property="idEntidadExterna">
        SE.CODG_ENTIDAD_EXTERNA IS NOT NULL
      </isNull>
      <isNotNull prepend="AND" property="idEntidadExterna">
        SE.CODG_ENTIDAD_EXTERNA = #idEntidadExterna:INTEGER#
      </isNotNull>
      <isNotNull prepend="AND" property="fechaInicial">
        SE.FECH_ENVIO <![CDATA[ >= ]]> #fechaInicial:DATE#
      </isNotNull>
      <isNotNull prepend="AND" property="fechaFinal">
        SE.FECH_ENVIO <![CDATA[ < ]]> #fechaFinal:DATE#
      </isNotNull>
      <isNotNull prepend="AND" property="apellidoPaterno">
        SP.APLL_PATER_SOLIC LIKE #apellidoPaterno:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="apellidoMaterno">
        SP.APLL_MATER_SOLIC LIKE #apellidoMaterno:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="nombre">
        (SP.NOM1_SOLIC LIKE #nombre:VARCHAR# OR SP.NOM2_SOLIC LIKE #nombre:VARCHAR# OR SP.NOM3_SOLIC LIKE #nombre:VARCHAR#)
      </isNotNull>
      <isNotNull prepend="AND" property="estado">
      	SE.CODG_ESTADO = #estado:CHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="nroOficio">
      	(SE.V_OFI_RESPUESTA_A LIKE #nroOficio:VARCHAR# OR  SE.V_OFI_RESPUESTA_B LIKE #nroOficio:VARCHAR#) 
      </isNotNull>
    </dynamic>
	 ORDER BY SE.FECH_REGISTRO DESC
  </select>

<resultMap class="pe.gob.pj.rnc.model.SolicitudExternaReporte" id="resultMapReporteA" groupBy="codg_certi_externo">
	<result column="CODG_CERTI_EXTERNO" jdbcType="INTEGER" property="codg_certi_externo"/>
	<result column="FECH_ENVIO" jdbcType="TIMESTAMP" property="fech_envio"/>
	<result column="V_OFI_RESPUESTA_A" jdbcType="VARCHAR" property="v_ofi_respuesta_a"/>
	<result column="V_OFI_RESPUESTA_B" jdbcType="VARCHAR" property="v_ofi_respuesta_b"/>
	<result column="codigo_del_motivo" jdbcType="CHAR" property="codigo_del_motivo"/>
	<result column="CODG_ENTIDAD_EXTERNA" jdbcType="INTEGER" property="codg_entidad_externa"/>
	<result column="SUP_NOMB_USUAR" jdbcType="VARCHAR" property="sup_nomb_usuar"/>
	<result column="SUP_APLL_USUAR" jdbcType="VARCHAR" property="sup_apll_usuar"/>
	<result column="SUP_DESC_TITULO" jdbcType="VARCHAR" property="sup_desc_titulo"/>
	<result column="firma_codigo" jdbcType="CHAR" property="firma_codigo"/>
	<result column="firma_nombre" jdbcType="VARCHAR" property="firma_nombre"/>
	<result column="firma_sumilla" jdbcType="VARCHAR" property="firma_sumilla"/>
	<result column="DESC_CIUDAD" jdbcType="VARCHAR" property="desc_ciudad"/>
	<result column="DESC_PAIS" jdbcType="VARCHAR" property="desc_pais"/>
    <result property="solicitudesList" resultMap="SOLICITUD_EXTERNA.resultMapSolicitudes"/>
  </resultMap>

  <resultMap class="pe.gob.pj.rnc.model.SolicitudReporte" id="resultMapSolicitudes">
  	<result column="CODG_CERTI" jdbcType="CHAR" property="codg_certi"/>
  	<result column="APLL_PATER_SOLIC" jdbcType="VARCHAR" property="apll_pater_solic"/>
  	<result column="APLL_MATER_SOLIC" jdbcType="VARCHAR" property="apll_mater_solic"/>
  	<result column="FECH_NACIM_SOLIC" jdbcType="TIMESTAMP" property="fech_nacim_solic"/>
  	<result column="NOM1_SOLIC" jdbcType="VARCHAR" property="nom1_solic"/>
  	<result column="NOM2_SOLIC" jdbcType="VARCHAR" property="nom2_solic"/>
    <result column="NOM3_SOLIC" jdbcType="VARCHAR" property="nom3_solic"/>
    <result column="NOM4_SOLIC" jdbcType="VARCHAR" property="nom4_solic"/>
    <result column="NOM5_SOLIC" jdbcType="VARCHAR" property="nom5_solic"/>
    <result column="NOM_PADRE" jdbcType="VARCHAR" property="nom_padre"/>
    <result column="NOM_MADRE" jdbcType="VARCHAR" property="nom_madre"/>
    <result column="TIPO_SOLIC" jdbcType="CHAR" property="tipo_solic"/>
    <result column="NUME_IDENT_SOLIC" jdbcType="CHAR" property="nume_ident_solic"/>
    <result column="L_NACIDO_EXTERIOR" jdbcType="CHAR" property="flagNacidoExterior"/>
    <result column="LUGAR_NACIMIENTO" jdbcType="VARCHAR" property="lugarNacimiento"/>
    <result column="doc_abreviatura" jdbcType="VARCHAR" property="doc_abreviatura"/>
    <result column="dep_descripcion" jdbcType="VARCHAR" property="dep_descripcion"/>
    <result column="motivo_descripcion" jdbcType="VARCHAR" property="motivo_descripcion"/>
    <result column="INDC_DESCARTE" jdbcType="CHAR" property="indc_descarte"/>
    <result column="INDC_REGISTRA" jdbcType="CHAR" property="indc_registra"/>
  </resultMap>

  <select id="reporteSolicitudExterna" parameterClass="Map" resultMap="resultMapReporteA">
  SELECT
  	 se.CODG_CERTI_EXTERNO, se.FECH_ENVIO, se.V_OFI_RESPUESTA_A, se.V_OFI_RESPUESTA_B, se.codigo_del_motivo, se.CODG_ENTIDAD_EXTERNA,
  	 u.NOMB_USUAR SUP_NOMB_USUAR, u.APLL_USUAR SUP_APLL_USUAR, u.DESC_TITULO SUP_DESC_TITULO,
	 firma.CODG_USU_FIRMA firma_codigo, firma.DESC_NOMBRE firma_nombre, firma.DESC_SUMILLA firma_sumilla,
	 ee.DESC_CIUDAD, ( SELECT DESC_PAIS FROM PAIS p WHERE p.CODG_PAIS = ee.CODG_PAIS ) DESC_PAIS,
	 sp.CODG_CERTI, sp.APLL_PATER_SOLIC, sp.APLL_MATER_SOLIC, sp.FECH_NACIM_SOLIC,
	 sp.NOM1_SOLIC, sp.NOM2_SOLIC, sp.NOM3_SOLIC, sp.NOM4_SOLIC, sp.NOM5_SOLIC,
	 sp.NOM_PADRE, sp.NOM_MADRE, sp.TIPO_SOLIC, sp.NUME_IDENT_SOLIC, sp.L_NACIDO_EXTERIOR, sp.LUGAR_NACIMIENTO,
	 di.abreviatura doc_abreviatura, d.DESC_LUGAR dep_descripcion, m.descripcion motivo_descripcion,
	 sei.INDC_DESCARTE, sei.INDC_REGISTRA
	FROM SOLICITUD_EXTERNA se
	INNER JOIN SOLICITUD_EXTERNA_ITEM sei ON  sei.CODG_CERTI_EXTERNO = se.CODG_CERTI_EXTERNO
	INNER JOIN SOLICITUDES_PROVINCIA sp ON sei.CODG_CERTI = sp.CODG_CERTI
	LEFT JOIN USUARIO u ON u.CODG_USUAR = se.CODG_SUPERVISOR
	LEFT JOIN FIRMA_AUTORIZADA firma ON se.CODG_FIRMA_RNC = firma.CODG_USU_FIRMA
	INNER JOIN ENTIDAD_EXTERNA ee ON se.CODG_ENTIDAD_EXTERNA = ee.CODG_ENTIDAD_EXTERNA
	INNER JOIN motivos_solicitud_certificados m ON sp.MOTI_SOLIC = m.codigo_del_motivo
	LEFT JOIN documentos_de_identidad di ON sp.DOCU_IDENT_SOLIC = di.codigo_tipo_documento
	LEFT JOIN DEPARTAMENTO d ON sp.X_CODG_LUGAR_NAC = d.CODG_LUGAR
	WHERE se.CODG_CERTI_EXTERNO = #codg_certi_externo:INTEGER#
	<isNotNull prepend="AND" property="indc_descarte">
		sei.INDC_DESCARTE = #indc_descarte:CHAR#
	</isNotNull>
	ORDER BY sp.APLL_PATER_SOLIC, sp.APLL_MATER_SOLIC, sp.NOM1_SOLIC
  </select>
  
 
    <select id="buscarSolicitudPorNombreUsuarioFecha" parameterClass="pe.gob.pj.rnc.model.Solicitud" resultClass="pe.gob.pj.rnc.model.SolicitudExterna">

    select SE.CODG_CERTI_EXTERNO
    from SOLICITUDES_PROVINCIA SP
    INNER JOIN SOLICITUD_EXTERNA_ITEM SEI ON SP.CODG_CERTI=SEI.CODG_CERTI
    INNER JOIN SOLICITUD_EXTERNA SE ON SE.CODG_CERTI_EXTERNO = SEI.CODG_CERTI_EXTERNO
  	WHERE 
  	SP.APLL_PATER_SOLIC= #APLL_PATER_SOLIC:VARCHAR# 
   	AND SP.APLL_MATER_SOLIC=#APLL_MATER_SOLIC:VARCHAR# 
	AND SP.NOM1_SOLIC=#NOM1_SOLIC:VARCHAR# 
	AND SP.NOM2_SOLIC=#NOM2_SOLIC:VARCHAR# 
	AND SP.NOM3_SOLIC=#NOM3_SOLIC:VARCHAR# 
	AND SP.CODG_USUAR=#CODG_USUAR:VARCHAR# 
	AND YEAR(SP.FECH_REGISTRO)=#anio:INTEGER#  
	AND MONTH(SP.FECH_REGISTRO)=#mes:INTEGER#   
	AND DAY(SP.FECH_REGISTRO)=#dia:INTEGER#
	ORDER BY   SP.FECH_REGISTRO DESC 
  </select>
  
  <select id="consultarSolicitudesExternas" parameterClass="pe.gob.pj.rnc.criterio.CriterioListarSolicitud" resultClass="pe.gob.pj.rnc.model.SolicitudExterna">	  
	SELECT distinct SE.CODG_CERTI_EXTERNO, SE.CODG_ESTADO, codigo_del_motivo, USU.NOMB_USUAR+' '+USU.APLL_USUAR as CODG_USUAR, 
    SE.CODG_ENTIDAD_EXTERNA, SE.V_OFI_RESPUESTA_A, SE.V_OFI_RESPUESTA_B,  SE.FECH_REGISTRO, SE.FECH_ENVIO,
	SE.FECH_ATENCION, SE.NUM_VISTAS_OFI_RESPUESTA_A, SE.NUM_VISTAS_OFI_RESPUESTA_B,  SE.DESC_REFERENCIA, SE.NUM_REGISTROS_ATENDIDOS,
	SE.NUM_REGISTROS_POR_ATENDER, ESC.DESC_ESTADO
	from dbo.SOLICITUD_EXTERNA SE
	INNER JOIN dbo.SOLICITUD_EXTERNA_ITEM SEI ON SE.CODG_CERTI_EXTERNO = SEI.CODG_CERTI_EXTERNO
	INNER JOIN dbo.SOLICITUDES_PROVINCIA SP ON SEI.CODG_CERTI = SP.CODG_CERTI
	INNER JOIN dbo.ESTADO_SOLICITUD_CERTIFICADO ESC ON ESC.CODG_ESTADO = SE.CODG_ESTADO
    INNER JOIN dbo.USUARIO USU ON USU.CODG_USUAR = SE.CODG_USUAR	  
	<dynamic prepend="WHERE">
      <isNotNull prepend="AND" property="codigoUsuario">
        SE.CODG_USUAR LIKE #codigoUsuario:VARCHAR#
      </isNotNull>
      <isNull prepend="AND" property="idEntidadExterna">
        SE.CODG_ENTIDAD_EXTERNA IS NOT NULL
      </isNull>
      <isNotNull prepend="AND" property="idEntidadExterna">
        SE.CODG_ENTIDAD_EXTERNA = #idEntidadExterna:INTEGER#
      </isNotNull>
      <isNotNull prepend="AND" property="fechaInicial">
        SE.FECH_ENVIO <![CDATA[ >= ]]> #fechaInicial:DATE#
      </isNotNull>
      <isNotNull prepend="AND" property="fechaFinal">
        SE.FECH_ENVIO <![CDATA[ < ]]> #fechaFinal:DATE#
      </isNotNull>
      <isNotNull prepend="AND" property="apellidoPaterno">
        SP.APLL_PATER_SOLIC LIKE #apellidoPaterno:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="apellidoMaterno">
        SP.APLL_MATER_SOLIC LIKE #apellidoMaterno:VARCHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="nombre">
        (SP.NOM1_SOLIC LIKE #nombre:VARCHAR# OR SP.NOM2_SOLIC LIKE #nombre:VARCHAR# OR SP.NOM3_SOLIC LIKE #nombre:VARCHAR#)
      </isNotNull>
      <isNotNull prepend="AND" property="estado">
      	SE.CODG_ESTADO = #estado:CHAR#
      </isNotNull>
      <isNotNull prepend="AND" property="nroOficio">
      	(SE.V_OFI_RESPUESTA_A LIKE #nroOficio:VARCHAR# OR  SE.V_OFI_RESPUESTA_B LIKE #nroOficio:VARCHAR#) 
      </isNotNull>
      <isNotNull prepend="AND" property="nroSolicitud">
      	SE.CODG_CERTI_EXTERNO = #nroSolicitud:INTEGER#  
      </isNotNull>
    </dynamic>
	 ORDER BY SE.FECH_REGISTRO DESC
  </select>
  
</sqlMap>
